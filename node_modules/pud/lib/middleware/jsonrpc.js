'use strict';

module.exports = function jsonrpc(ctx, next) {
  let msg = ctx.msg;

  if (typeof msg !== 'object') return ctx.throw(-32600);
  if (!msg.method) return ctx.throw(-32602, 'Method not specified');
  if (typeof msg.method !== 'string') return ctx.throw(-32600, 'Invalid method name');
  if (!ctx.app.methods[msg.method]) return ctx.throw(-32601, 'Method not found');
  if (msg.params && typeof msg.params === 'string') return ctx.throw(-32600, 'Invalid params');
  if (!msg.id && !Array.isArray(msg)) ctx.silent = true; // client sent a notification, so we won't need a reply

  return next();
};
